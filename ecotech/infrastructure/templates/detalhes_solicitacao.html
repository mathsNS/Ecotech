{% extends "base.html" %}

{% block title %}Detalhes da Solicitação - EcoTech{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <a href="{{ url_for('dashboard') }}" class="back-link">← Voltar</a>
        <h1>Detalhes da Solicitação</h1>
        <p>ID: {{ solicitacao.id }}</p>
    </div>

    <div class="solicitation-details">
        <div class="details-card">
            <h3>Status Atual</h3>
            <div class="status-timeline">
                <div class="status-current">
                    <span class="status-badge-large status-{{ solicitacao.estado.obter_nome().lower().replace(' ', '-') }}">
                        {{ solicitacao.estado.obter_nome() }}
                    </span>
                    <p>{{ solicitacao.estado.obter_descricao() }}</p>
                </div>
            </div>
        </div>

        <div class="details-card">
            <h3>Informações da Solicitação</h3>
            <div class="details-grid">
                <div class="detail-item">
                    <span class="detail-label">Data de Criação:</span>
                    <span class="detail-value">{{ solicitacao.data_criacao.strftime('%d/%m/%Y %H:%M') }}</span>
                </div>
                
                {% if solicitacao.data_agendamento %}
                <div class="detail-item">
                    <span class="detail-label">Data Agendada:</span>
                    <span class="detail-value">{{ solicitacao.data_agendamento.strftime('%d/%m/%Y %H:%M') }}</span>
                </div>
                {% endif %}
                
                {% if solicitacao.ponto_coleta %}
                <div class="detail-item">
                    <span class="detail-label">Ponto de Coleta:</span>
                    <span class="detail-value">{{ solicitacao.ponto_coleta.nome }}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Endereço:</span>
                    <span class="detail-value">{{ solicitacao.ponto_coleta.endereco }}</span>
                </div>
                {% endif %}
                
                <div class="detail-item">
                    <span class="detail-label">Peso Total:</span>
                    <span class="detail-value">{{ solicitacao.calcular_peso_total()|round(2) }} kg</span>
                </div>
                
                <div class="detail-item">
                    <span class="detail-label">Impacto Ambiental:</span>
                    <span class="detail-value">{{ solicitacao.calcular_impacto_total()|round(2) }}</span>
                </div>
                
                {% if solicitacao.metodo_tratamento %}
                <div class="detail-item">
                    <span class="detail-label">Método de Tratamento:</span>
                    <span class="detail-value">{{ solicitacao.metodo_tratamento.obter_nome() }}</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Custo Estimado:</span>
                    <span class="detail-value">R$ {{ solicitacao.calcular_custo_tratamento()|round(2) }}</span>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="details-card">
            <h3>Itens da Solicitação</h3>
            <div class="items-list">
                {% for item in solicitacao.itens %}
                <div class="item-card">
                    <div class="item-icon">
                        <img src="{{ url_for('static', filename='images/dispositivo.png') }}" alt="Dispositivo" style="width: 32px; height: 32px;">
                    </div>
                    <div class="item-info">
                        <h4>{{ item.dispositivo.nome }}</h4>
                        <p>{{ item.dispositivo.obter_tipo() }}</p>
                        <p class="item-details">
                            Quantidade: {{ item.quantidade }} | 
                            Peso unitário: {{ item.dispositivo.peso_kg }} kg | 
                            Ano: {{ item.dispositivo.ano_fabricacao }}
                        </p>
                        {% if item.observacoes %}
                        <p class="item-obs">Obs: {{ item.observacoes }}</p>
                        {% endif %}
                    </div>
                    <div class="item-stats">
                        <span class="item-weight">{{ item.calcular_peso_total()|round(2) }} kg</span>
                        <span class="item-impact">Impacto: {{ item.calcular_impacto_total()|round(1) }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        {% if solicitacao.mensagem_instituicao %}
        <div class="details-card success-card">
            <h3>✅ Tudo certo!</h3>
            <p>{{ solicitacao.mensagem_instituicao }}</p>
            <p><strong>A empresa parceira já foi avisada da sua visita.</strong></p>
            <p>Lembre-se de levar o horário de funcionamento.</p>
            <a href="{{ url_for('dashboard') }}" class="btn btn-primary">Finalizar</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
